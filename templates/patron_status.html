{% extends "base.html" %}

{% block content %}
<h2>ðŸ‘¤ Patron Status</h2>

<form method="POST" style="margin-bottom: 16px;">
  <label for="patron_id"><strong>Patron ID (6 digits):</strong></label>
  <input id="patron_id" name="patron_id" type="text" value="{{ patron_id or '' }}"
         required maxlength="6" pattern="\d{6}" style="width: 140px; margin: 0 8px;">
  <button type="submit" class="btn">View Status</button>
</form>

{% if report %}
  <h3>Summary</h3>
  <ul>
    <li><strong>Patron:</strong> {{ report.patron_id }}</li>
    <li><strong>Books currently borrowed:</strong> {{ report.books_borrowed_count }}</li>
    <li><strong>Total late fees owed (active loans):</strong> ${{ '%.2f'|format(report.total_late_fees_owed) }}</li>
  </ul>

  <h3>Currently Borrowed</h3>
  {% if report.current_loans %}
    <table>
      <thead>
        <tr>
          <th>Book ID</th><th>Title</th><th>Author</th>
          <th>Borrowed</th><th>Due</th><th>Overdue?</th>
        </tr>
      </thead>
      <tbody>
        {% for loan in report.current_loans %}
        <tr>
          <td>{{ loan.book_id }}</td>
          <td>{{ loan.title }}</td>
          <td>{{ loan.author }}</td>
          <td>{{ loan.borrow_date }}</td>
          <td>{{ loan.due_date }}</td>
          <td>{{ 'Yes' if loan.is_overdue else 'No' }}</td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  {% else %}
    <p>No active loans.</p>
  {% endif %}

  <h3>Borrowing History</h3>
  {% if report.borrow_history %}
    <table>
      <thead>
        <tr>
          <th>Book ID</th><th>Title</th><th>Author</th>
          <th>Borrowed</th><th>Due</th><th>Returned</th><th>Was Late?</th><th>Fee at Return</th>
        </tr>
      </thead>
      <tbody>
        {% for h in report.borrow_history %}
        <tr>
          <td>{{ h.book_id }}</td>
          <td>{{ h.title }}</td>
          <td>{{ h.author }}</td>
          <td>{{ h.borrow_date }}</td>
          <td>{{ h.due_date }}</td>
          <td>{{ h.return_date or '-' }}</td>
          <td>{{ 'Yes' if h.was_late else 'No' }}</td>
          <td>${{ '%.2f'|format(h.fee_at_return) }}</td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  {% else %}
    <p>No history yet.</p>
  {% endif %}
{% endif %}
{% endblock %}